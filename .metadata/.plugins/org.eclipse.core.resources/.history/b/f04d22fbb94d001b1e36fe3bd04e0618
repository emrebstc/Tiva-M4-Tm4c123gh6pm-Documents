#include "stdint.h"
#include"inc/tm4c123gh6pm.h"

void init_i2c();

int Writei2c(uint32_t adress,uint8_t data){
    I2C0_MSA_R= (adress<<1)+0; // write modu adres seçimi
    I2C0_MDR_R=data;
    I2C0_MCS_R=0x07; // start, transmit,stop
    while(I2C0_MCS_R & 0x40); // busy bekler
    if (!(I2C0_MCS_R & 0x02))
    {
        return 0; // hata yok
    } else {
        return 1; // hata var
    }
}

uint8_t Readi2c(int32_t adress){
    // receive
    I2C0_MSA_R= (adress<<1)+1; // arduino i2c slave - adama cevap vermem lazım
    I2C0_MCS_R=0x07; // haberleşme başladı
    while(I2C0_MCS_R & 0x01); // busy bekler

    if (!(I2C0_MCS_R & 0x02))
    {
        int x=7;
    }

    uint8_t geleveri=I2C0_MDR_R;
}

int main()
{

    init_i2c();

    int error=Writei2c(0x55,'T');


	return 0;
}

void init_i2c()
{
    // i2c0 aktif
    SYSCTL_RCGCI2C_R|=0x01;
    // portb aktif
    SYSCTL_RCGCGPIO_R|=0x02;
    GPIO_PORTB_DEN_R |=0x0c;  // pb2 ve pb3 aktif 0000 1100
    //alternatif fonksiyon
    GPIO_PORTB_AFSEL_R |=0x0c;
    // open drain pull up
    GPIO_PORTB_ODR_R|=0x08;  // sda için open drain yapıldı
    GPIO_PORTB_PCTL_R|=0x03;
    I2C0_MCR_R|=0x0010; // master
    I2C0_MTPR_R=7; // 100 kbps
}
